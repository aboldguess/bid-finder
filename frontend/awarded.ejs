<!DOCTYPE html>
<html>
<head>
  <title>Tender Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1>Awarded Contracts</h1>
  <%- include('partials/nav', { page: 'awarded', user: user }) %>
  <table>
    <tr>
      <th>Title</th>
      <th data-type="date">Date</th>
      <th>Description</th>
      <th data-type="source">Source</th>
      <!-- Track when each award was retrieved -->
      <th data-type="date">Scraped At</th>
      <th>Tags</th>
      <th>Link</th>
    </tr>
    <% tenders.forEach(t => { %>
      <tr class="tenderRow toggle-row" data-id="<%= t.id %>">
        <td><%= t.title %></td>
        <td><%= t.date %></td>
        <td><%= t.description %></td>
        <td><%= t.source %></td>
        <!-- Full timestamp available for investigations -->
        <td><%= t.scraped_at %></td>
        <td><%= t.tags %></td>
        <!-- Open award links in a new tab to keep the list available -->
        <td><a href="<%= t.link %>" target="_blank">View</a></td>
      </tr>
      <tr class="detailRow" data-id="<%= t.id %>">
        <td colspan="7">
          <table>
            <tr><th>Title</th><td><%= t.title %></td></tr>
            <tr><th>Date</th><td><%= t.date %></td></tr>
            <tr><th>Description</th><td><%= t.description %></td></tr>
            <tr><th>Source</th><td><%= t.source %></td></tr>
            <!-- Timestamp for precise audit trail -->
            <tr><th>Scraped At</th><td><%= t.scraped_at %></td></tr>
            <tr><th>Tags</th><td><%= t.tags %></td></tr>
            <tr><th>Link</th><td><a href="<%= t.link %>" target="_blank"><%= t.link %></a></td></tr>
          </table>
        </td>
      </tr>
    <% }) %>
    <% if (tenders.length === 0) { %>
      <tr><td colspan="7">No awarded contracts found. Scrape an award source to populate this list.</td></tr>
    <% } %>
  </table>
  <!-- table-tools.js handles row detail toggling and table utilities -->
  <script src="/table-tools.js"></script>
</body>
</html>
